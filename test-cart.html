<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart Test - KNUST Enterprise Hub</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container mt-5">
        <h1>Cart Functionality Test</h1>
        
        <!-- Test Products -->
        <div class="row mt-4">
            <div class="col-md-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Test Product 1</h5>
                        <p class="card-text">GHS 25.00</p>
                        <button class="btn btn-primary add-to-cart" 
                                data-name="Test Product 1" 
                                data-price="25.00" 
                                data-image="https://via.placeholder.com/150"
                                data-business="Test Business">
                            Add to Cart
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Test Product 2</h5>
                        <p class="card-text">GHS 30.00</p>
                        <button class="btn btn-primary add-to-cart" 
                                data-name="Test Product 2" 
                                data-price="30.00" 
                                data-image="https://via.placeholder.com/150"
                                data-business="Test Business">
                            Add to Cart
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cart Button -->
        <div class="mt-4">
            <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#cartModal">
                <i class="fas fa-shopping-cart"></i> 
                Cart (<span class="cart-count">0</span>)
            </button>
        </div>

        <!-- Cart Modal -->
        <div class="modal fade" id="cartModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Your Shopping Cart</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div id="cartItems">
                            <div class="text-center py-4">
                                <i class="fas fa-shopping-cart fa-3x text-muted mb-3"></i>
                                <p>Your cart is empty</p>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Continue Shopping</button>
                        <button type="button" class="btn btn-primary">Proceed to Checkout</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Cart functionality
        const cart = {
            items: [],
            addItem: function(product) {
                // Check if item already exists in cart
                const existingItem = this.items.find(item => item.id === product.id);
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    this.items.push({ ...product, quantity: 1 });
                }
                this.updateCart();
                this.showNotification(`${product.name} added to cart`);
            },
            removeItem: function(productId) {
                this.items = this.items.filter(item => item.id !== productId);
                this.updateCart();
            },
            updateQuantity: function(productId, quantity) {
                const item = this.items.find(item => item.id === productId);
                if (item) {
                    if (quantity <= 0) {
                        this.removeItem(productId);
                    } else {
                        item.quantity = quantity;
                    }
                }
                this.updateCart();
            },
            updateCart: function() {
                document.querySelector('.cart-count').textContent = this.items.length;
                this.renderCartItems();
                localStorage.setItem('cart', JSON.stringify(this.items));
            },
            renderCartItems: function() {
                const cartItemsEl = document.querySelector('#cartItems');
                
                if (this.items.length === 0) {
                    cartItemsEl.innerHTML = `
                        <div class="text-center py-4">
                            <i class="fas fa-shopping-cart fa-3x text-muted mb-3"></i>
                            <p>Your cart is empty</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                let total = 0;
                
                this.items.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;
                    
                    html += `
                        <div class="cart-item border-bottom pb-3 mb-3">
                            <div class="row align-items-center">
                                <div class="col-md-2">
                                    <img src="${item.image}" alt="${item.name}" class="img-fluid rounded" style="width: 60px; height: 60px; object-fit: cover;">
                                </div>
                                <div class="col-md-4">
                                    <h6 class="mb-1">${item.name}</h6>
                                    <small class="text-muted">${item.business}</small>
                                </div>
                                <div class="col-md-2 text-center">
                                    <input type="number" value="${item.quantity}" min="1" class="form-control form-control-sm" 
                                           onchange="cart.updateQuantity(${item.id}, this.value)">
                                </div>
                                <div class="col-md-2 text-end">
                                    <span class="fw-bold">GHS ${itemTotal.toFixed(2)}</span>
                                </div>
                                <div class="col-md-2 text-end">
                                    <button class="btn btn-sm btn-link text-danger" onclick="cart.removeItem(${item.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += `
                    <div class="text-end">
                        <h5>Total: GHS ${total.toFixed(2)}</h5>
                    </div>
                `;
                
                cartItemsEl.innerHTML = html;
            },
            showNotification: function(message) {
                const notification = document.createElement('div');
                notification.className = 'position-fixed bottom-0 end-0 m-3 alert alert-success alert-dismissible fade show';
                notification.style.zIndex = '1100';
                notification.innerHTML = `
                    <i class="fas fa-check-circle me-2"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => notification.remove(), 150);
                }, 3000);
            },
            loadFromStorage: function() {
                const savedCart = localStorage.getItem('cart');
                if (savedCart) {
                    this.items = JSON.parse(savedCart);
                    this.updateCart();
                }
            }
        };

        // Add to cart buttons
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('add-to-cart')) {
                const product = {
                    id: Date.now() + Math.random(), // Generate unique ID
                    name: e.target.dataset.name,
                    price: parseFloat(e.target.dataset.price),
                    image: e.target.dataset.image,
                    business: e.target.dataset.business
                };
                cart.addItem(product);
            }
        });

        // Load cart from localStorage on page load
        document.addEventListener('DOMContentLoaded', function() {
            cart.loadFromStorage();
        });
    </script>
</body>
</html>
